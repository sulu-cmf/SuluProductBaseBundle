define(["services/product/product-content-manager","services/product/product-manager","suluproduct/util/header"],function(a,b,c){"use strict";var d={data:{}},e={formId:"content-form"},f={form:"#"+e.formId},g={content:['<form id="'+e.formId+'">','   <div class="highlight-section fixed-width">','       <div class="grid-row content">','           <div class="form-group floating grid-col-12">','               <label for="title" class="pointer "><%= translate(\'public.title\') %></label>','               <input id="title" data-mapper-property="title" type="text" class="form-element input-large"/>',"           </div>",'           <div class="floating grid-col-12">','           <div class="form-group grid-col-6">','               <label for="routePath" class="pointer "><%= translate(\'sulu_product.route-path\') %></label>','               <input id="routePath" data-mapper-property="routePath" type="text" class="form-element"/>',"           </div>","           </div>","       </div>","   </div>","</form>"].join("")},h=function(){this.sandbox.on("sulu.toolbar.save",i.bind(this))},i=function(){if(this.sandbox.form.validate(f.form)){var d=this.sandbox.form.getData(f.form),e=a.save(this.options.data.id,this.options.locale,d),g=!0,h=c.retrieveChangedStatus();h&&(g=b.saveStatus(this.options.data.id,h)),this.sandbox.util.when(e,g).then(j.bind(this))}},j=function(){alert("all data saved, show label"),c.setSaveButton(!1)},k=function(a){var b=$.Deferred();return this.formObject||(this.formObject=this.sandbox.form.create(f.form)),this.formObject.initialized.then(function(){this.sandbox.form.setData(f.form,a).then(function(){b.resolve()})}.bind(this)),b.promise()},l=function(){return this.sandbox.dom.on(this.$el,"keyup",c.setSaveButton.bind(this,!0)),!0},m=function(){this.listenerEnabled||(this.listenerEnabled=l.call(this))},n=function(a){this.sandbox.dom.html(this.$el,_.template(g.content,{translate:this.sandbox.translate})),k.call(this,a).then(m.bind(this))};return{layout:function(){return{extendExisting:!0,content:{width:"fixed",rightSpace:!1,leftSpace:!1}}},initialize:function(){this.listenerEnabled=!1,this.options=this.sandbox.util.extend(!0,{},d,this.options),this.status=this.options.data.attributes.status,this.sandbox.emit("product.state.change",this.status),a.load(this.options.data.id,this.options.locale).then(n.bind(this)),h.call(this)}}});